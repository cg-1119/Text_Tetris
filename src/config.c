#include "include/config.h"
#include <time.h>

char tetris_table[TABLE_ROWS][TABLE_COLS];

char i_block[4][4][4] = {
    { {0,0,1,0}, {0,0,1,0}, {0,0,1,0}, {0,0,1,0} },
    { {0,0,0,0}, {0,0,0,0}, {0,0,0,0}, {1,1,1,1} },
    { {0,1,0,0}, {0,1,0,0}, {0,1,0,0}, {0,1,0,0} },
    { {1,1,1,1}, {0,0,0,0}, {0,0,0,0}, {0,0,0,0} }
};
char t_block[4][4][4] = {
    {{1,0,0,0},{1,1,0,0},{1,0,0,0},{0,0,0,0}},
    {{1,1,1,0},{0,1,0,0},{0,0,0,0},{0,0,0,0}},
    {{0,0,1,0},{0,1,1,0},{0,0,1,0},{0,0,0,0}},
    {{0,0,0,0},{0,1,0,0},{1,1,1,0},{0,0,0,0}}
};
char s_block[4][4][4] = {
    {{1,0,0,0},{1,1,0,0},{0,1,0,0},{0,0,0,0}},
    {{0,1,1,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
    {{0,1,0,0},{0,1,1,0},{0,0,1,0},{0,0,0,0}},
    {{0,0,0,0},{0,1,1,0},{1,1,0,0},{0,0,0,0}}
};
char z_block[4][4][4] = {
    {{0,1,0,0},{1,1,0,0},{1,0,0,0},{0,0,0,0}},
    {{1,1,0,0},{0,1,1,0},{0,0,0,0},{0,0,0,0}},
    {{0,0,1,0},{0,1,1,0},{0,1,0,0},{0,0,0,0}},
    {{0,0,0,0},{1,1,0,0},{0,1,1,0},{0,0,0,0}}
};
char l_block[4][4][4] = {
    {{1,0,0,0},{1,0,0,0},{1,1,0,0},{0,0,0,0}},
    {{1,1,1,0},{1,0,0,0},{0,0,0,0},{0,0,0,0}},
    {{0,1,1,0},{0,0,1,0},{0,0,1,0},{0,0,0,0}},
    {{0,0,0,0},{0,0,1,0},{1,1,1,0},{0,0,0,0}}
};
char j_block[4][4][4] = {
    {{0,1,0,0},{0,1,0,0},{1,1,0,0},{0,0,0,0}},
    {{1,0,0,0},{1,1,1,0},{0,0,0,0},{0,0,0,0}},
    {{1,1,0,0},{1,0,0,0},{1,0,0,0},{0,0,0,0}},
    {{0,0,0,0},{0,0,0,0},{1,1,1,0},{0,0,1,0}}
};
char o_block[4][4][4] = {
    {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
    {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
    {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}},
    {{1,1,0,0},{1,1,0,0},{0,0,0,0},{0,0,0,0}}
};

char (*tetrominos[TETROMINO_COUNT])[4][4] = {
    i_block, t_block, s_block, z_block, l_block, j_block, o_block
};

Tetromino block_number;
Tetromino next_block_number;
int block_state = 0;
int x = 3;
int y = 0;


int game = GAME_END;

long point = 0;
int best_point;

int clear_lines = 0;

ResultList result_list = NULL;

char *filename = "points.txt";


Node* make_node(Result *result) {
    Node *tmp = malloc(sizeof(Node));
    if (!tmp) return NULL;
    memcpy(&tmp->data, result, sizeof(Result));
    tmp->next = NULL;
    return tmp;
}

void free_list() {
    Node *tmp = result_list;
    while (tmp ->next != NULL) {
        Node *next = tmp->next;
        free(tmp);
        tmp = next;
    }
    result_list = NULL;
}